PREFIX = "/usr"

PKGSTATEDIR = PREFIX + "/lib/galactic-bloodshed/"

PKGDATADIR = PREFIX + "/share/galactic-bloodshed/"

#DOCDIR = PREFIX + "/share/doc/galactic-bloodshed/"
DOCDIR = PREFIX + "/share/galactic-bloodshed/"

LLVM_COPTS_DEFAULT = [
    "-Werror",
    "-Wno-c++98-compat",  # Keep this one
    "-Wno-padded",  # Keep this one
    "-Wno-c++98-compat-pedantic",  # Keep
    "-fno-omit-frame-pointer",
]

LLVM_COPTS_OPTIONAL = [
    "-Wno-float-equal",
    "-Wno-old-style-cast",
    "-Wno-conversion",
    "-Wno-conditional-uninitialized",
    "-Wno-sign-compare",
    "-Wno-switch-enum",
    "-Wno-exit-time-destructors",
    "-Wno-global-constructors",
    "-Wno-writable-strings",
]

LLVM_COPTS = LLVM_COPTS_DEFAULT + LLVM_COPTS_OPTIONAL

GCC_COPTS = [
    "-Wno-sign-compare",
    "-Wno-maybe-uninitialized",
    "-Wno-return-type",
    "-Wno-unused-variable",
]

COPTS = GCC_COPTS + [
    '-DPKGSTATEDIR=\\"' + PKGSTATEDIR + '\\"',
    '-DPKGDATADIR=\\"' + PKGDATADIR + '\\"',
    '-DDOCDIR=\\"' + DOCDIR + '\\"',
    "-std=c++2a",
    "-O0",
    "-g3",
]

cc_binary(
    name = "makeuniv",
    srcs =
        [
            "GB_server.h",
            "buffers.h",
            "build.h",
            "config.h",
            "doturn.h",
            "files.cc",
            "files.h",
            "files_rw.cc",
            "files_rw.h",
            "files_shl.cc",
            "files_shl.h",
            "globals.h",
            "creator/makeplanet.cc",
            "creator/makeplanet.h",
            "creator/makestar.cc",
            "creator/makestar.h",
            "creator/makeuniv.cc",
            "creator/makeuniv.h",
            "map.h",
            "perm.cc",
            "perm.h",
            "power.h",
            "races.h",
            "utils/rand.cc",
            "utils/rand.h",
            "sector.cc",
            "ships.h",
            "sql/dbdecl.h",
            "sql/sql.cc",
            "sql/sql.h",
            "tweakables.h",
            "vars.h",
        ],
    copts = COPTS,
    linkopts = ["-lsqlite3"],
)

cc_binary(
    name = "enrol",
    srcs =
        [
            "GB_server.h",
            "buffers.h",
            "build.h",
            "config.h",
            "doturn.h",
            "enrol.cc",
            "files.cc",
            "files.h",
            "files_rw.cc",
            "files_rw.h",
            "files_shl.cc",
            "files_shl.h",
            "globals.h",
            "map.h",
            "max.cc",
            "max.h",
            "perm.cc",
            "perm.h",
            "power.h",
            "races.h",
            "utils/rand.cc",
            "utils/rand.h",
            "sector.cc",
            "shipdata.h",
            "ships.h",
            "shlmisc.cc",
            "shlmisc.h",
            "sql/dbdecl.h",
            "sql/sql.cc",
            "sql/sql.h",
            "tweakables.h",
            "vars.h",
        ],
    copts = COPTS,
    linkopts =
        [
            "-lsqlite3",
        ],
)

cc_import(
    name = "sqlite3",
    interface_library = "libsqlite3.so",
    system_provided = 1,
)

cc_binary(
    name = "GB",
    srcs = [
        "GB_server.cc",
    ],
    copts = COPTS,
    linkopts = ["-lsqlite3"],
    deps = [":gblib"],
)

cc_library(
    name = "gblib",
    srcs =
        [
            "GB_server.h",
            "VN.cc",
            "VN.h",
            "commands/analysis.cc",
            "commands/analysis.h",
            "commands/autoreport.cc",
            "commands/autoreport.h",
            "buffers.h",
            "build.cc",
            "build.h",
            "commands/capital.cc",
            "commands/capture.cc",
            "commands/colonies.cc",
            "commands/colonies.h",
            "commands/fix.cc",
            "commands/fix.h",
            "commands/governors.cc",
            "commands/governors.h",
            "commands/grant.cc",
            "commands/grant.h",
            "commands/production.cc",
            "commands/production.h",
            "commands/zoom.cc",
            "commands/zoom.h",
            "config.h",
            "cs.cc",
            "cs.h",
            "csp.h",
            "csp_types.h",
            "declare.cc",
            "defense.h",
            "commands/dissolve.cc",
            "dock.cc",
            "dosector.cc",
            "dosector.h",
            "doship.cc",
            "doship.h",
            "doturn.h",
            "doturncmd.cc",
            "doturncmd.h",
            "enslave.cc",
            "commands/examine.cc",
            "explore.cc",
            "files.cc",
            "files.h",
            "files_rw.cc",
            "files_rw.h",
            "files_shl.cc",
            "files_shl.h",
            "fire.cc",
            "fire.h",
            "fuel.cc",
            "fuel.h",
            "getplace.cc",
            "globals.h",
            "land.cc",
            "land.h",
            "launch.cc",
            "launch.h",
            "load.cc",
            "load.h",
            "map.cc",
            "map.h",
            "max.cc",
            "max.h",
            "mobiliz.cc",
            "move.cc",
            "move.h",
            "moveplanet.cc",
            "moveplanet.h",
            "moveship.cc",
            "moveship.h",
            "name.cc",
            "name.h",
            "orbit.cc",
            "order.cc",
            "order.h",
            "commands/perm.cc",
            "planet.cc",
            "power.h",
            "powercmd.cc",
            "prof.cc",
            "prof.h",
            "races.h",
            "utils/rand.cc",
            "utils/rand.h",
            "commands/relation.cc",
            "commands/rst.cc",
            "scrap.cc",
            "sector.cc",
            "shipdata.h",
            "ships.cc",
            "ships.h",
            "shlmisc.cc",
            "shlmisc.h",
            "shootblast.cc",
            "shootblast.h",
            "sql/dbdecl.h",
            "sql/sql.cc",
            "sql/sql.h",
            "survey.cc",
            "tech.cc",
            "tech.h",
            "tele.cc",
            "tele.h",
            "commands/toggle.cc",
            "commands/toxicity.cc",
            "tweakables.h",
            "vars.h",
            "victory.cc",
            "victory.h",
        ],
    copts = COPTS,
)

cc_binary(
    name = "racegen",
    srcs =
        [
            "GB_racegen.cc",
            "GB_racegen.h",
            "GB_server.h",
            "buffers.h",
            "build.h",
            "config.h",
            "doturn.h",
            "enroll.cc",
            "enroll.h",
            "files.cc",
            "files.h",
            "files_rw.cc",
            "files_rw.h",
            "files_shl.cc",
            "files_shl.h",
            "game_info.h",
            "globals.h",
            "map.h",
            "max.cc",
            "max.h",
            "perm.cc",
            "perm.h",
            "power.h",
            "racegen.cc",
            "racegen.h",
            "races.h",
            "utils/rand.cc",
            "utils/rand.h",
            "sector.cc",
            "shipdata.h",
            "ships.h",
            "shlmisc.cc",
            "shlmisc.h",
            "sql/dbdecl.h",
            "sql/sql.cc",
            "sql/sql.h",
            "tweakables.h",
            "vars.h",
        ],
    copts = COPTS,
    linkopts = ["-lsqlite3"],
)

cc_test(
    name = "shlmisc-test",
    srcs = [
        "GB_server.h",
        "buffers.h",
        "build.h",
        "config.h",
        "doturn.h",
        "files.h",
        "files_shl.h",
        "globals.h",
        "map.h",
        "max.h",
        "power.h",
        "races.h",
        "ships.h",
        "shlmisc.h",
        "shlmisc_test.cc",
        "tweakables.h",
        "vars.h",
    ],
    #    deps = [":gblib"],
    copts = COPTS,
    linkopts = ["-lsqlite3"],
)
